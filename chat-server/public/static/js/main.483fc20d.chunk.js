(this["webpackJsonpchat-client"]=this["webpackJsonpchat-client"]||[]).push([[0],{104:function(e,t,n){e.exports=n(147)},109:function(e,t,n){},144:function(e,t){},147:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(9),i=n.n(r),o=(n(109),n(12)),s=n(188),u=n(16),f=n(148),d=n(32),l=n(189),m=n(180),O=n(15),b=n(37),E=function(){function e(t){Object(O.a)(this,e),this._context=t}return Object(b.a)(e,[{key:"enterRoom",value:function(e){this._context.emits.enterRoom(e)}},{key:"sendMessage",value:function(e){this._context.emits.sendMessage(e)}},{key:"sendOffer",value:function(e){this._context.webrtc.emits.sendOffer(e)}},{key:"sendAnswer",value:function(e){this._context.webrtc.emits.sendAnswer(e)}},{key:"sendIceCandidateOffer",value:function(e){this._context.webrtc.emits.sendIceCandidateOffer(e)}},{key:"sendIceCandidateAnswer",value:function(e){this._context.webrtc.emits.sendIceCandidateAnswer(e)}},{key:"id",get:function(){return this._context.id}},{key:"isChatEntered",get:function(){return this._context.isChatEntered}},{key:"isConnected",get:function(){return this._context.isConnected}},{key:"message",get:function(){return this._context.message}},{key:"room",get:function(){return this._context.room}},{key:"users",get:function(){return this._context.users}},{key:"offerContext",get:function(){return this._context.webrtc.offerContext}},{key:"answerContext",get:function(){return this._context.webrtc.answerContext}},{key:"iceCandidateOffer",get:function(){return this._context.webrtc.iceCandidateOffer}},{key:"iceCandidateAnswer",get:function(){return this._context.webrtc.iceCandidateAnswer}}]),e}(),j=Object(a.createContext)(),h=function(){var e=Object(a.useContext)(j);return new E(e)},C=n(11),w=function e(t,n){Object(O.a)(this,e),this.username=t,this.room=n},p=function(e){var t=Object(a.useState)(!0),n=Object(u.a)(t,2),c=n[0],r=n[1];return[function(t){"Enter"===t.key&&(e(),r(!0))},c]},v=n(13);function g(){var e=Object(o.a)(["\n  margin: 10px 0;\n"]);return g=function(){return e},e}function y(){var e=Object(o.a)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n  padding: 20px;\n"]);return y=function(){return e},e}var x=Object(v.a)(f.a)(y()),k=Object(v.a)(l.a)(g()),_=Object(a.memo)((function(){var e=Object(a.useState)(""),t=Object(u.a)(e,2),n=t[0],r=t[1],i=Object(C.e)(),o=h(),s=function(){o.isConnected&&o.enterRoom(new w(n,i.pathname.slice(1)))},f=p(s),l=Object(u.a)(f,2),O=l[0],b=l[1];return c.a.createElement(x,null,c.a.createElement(d.a,{variant:"subtitle1",color:"primary",component:"h1"},"My chat server"),c.a.createElement(k,{id:"username",label:n?"Name":"Enter your name",value:n,onChange:function(e){r(e.target.value)},className:"WelcomePage_field",onKeyPress:O,focused:b,autoFocus:!0}),c.a.createElement(m.a,{variant:"outlined",color:"primary",disabled:!n,onClick:s},"Join chat"))})),S=n(190),A=n(91),I=n(182),R=n(183),N=n(181),D=function(e){return new Date(e).toLocaleTimeString("en-US")};function M(){var e=Object(o.a)(["\n  display: inline-block;\n  align-self: ",";\n  margin-bottom: 10px;\n  max-width: 70%;\n"]);return M=function(){return e},e}var T=Object(v.a)(N.a)(M(),(function(e){return e.ismine?"flex-end":"flex-start"})),F=Object(a.memo)((function(e){var t=e.message,n=e.isown;return c.a.createElement(T,{key:t.timestamp+t.sender,variant:"outlined",ismine:n?1:0},c.a.createElement(I.a,{title:c.a.createElement(d.a,{variant:"subtitle1",color:"primary"},t.sender),subheader:c.a.createElement(d.a,{variant:"subtitle2",color:"textSecondary",display:"block",noWrap:!1},D(t.timestamp))}),c.a.createElement(R.a,null,c.a.createElement(d.a,null,t.text)))}));function W(){var e=Object(o.a)(["\n  padding: 10px 20px;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-end;\n  min-height: 90%;\n"]);return W=function(){return e},e}function L(){var e=Object(o.a)(["\n  height: 400px;\n  overflow: auto;\n  margin-bottom: 20px;\n"]);return L=function(){return e},e}var G=Object(v.a)(f.a)(L()),U=v.a.div(W());function P(e,t){switch(t.type){case J.ADD_MESSAGE:return t.message?[].concat(Object(A.a)(e),[t.message]):e;default:return e}}var J={ADD_MESSAGE:0},B=Object(a.memo)((function(){var e=Object(a.useReducer)(P,[]),t=Object(u.a)(e,2),n=t[0],r=t[1],i=h(),o=Object(a.useRef)(null);return Object(a.useEffect)((function(){r({type:J.ADD_MESSAGE,message:i.message})}),[i.message]),Object(a.useEffect)((function(){o.current.scrollIntoView({behavior:"smooth"})}),[n]),c.a.createElement(G,null,c.a.createElement(U,null,n.map((function(e){return c.a.createElement(F,{key:e.timestamp,message:e,isown:e.id===i.id})})),c.a.createElement("div",{ref:o})))})),K=function e(t){Object(O.a)(this,e),this.text=t};function V(){var e=Object(o.a)(["\n  margin-right: 10px;\n  flex: 1;\n"]);return V=function(){return e},e}function q(){var e=Object(o.a)(["\n  padding: 10px 20px;\n  display: flex;\n"]);return q=function(){return e},e}var z=Object(v.a)(f.a)(q()),H=Object(v.a)(l.a)(V()),Q=Object(a.memo)((function(){var e=Object(a.useState)(""),t=Object(u.a)(e,2),n=t[0],r=t[1],i=h(),o=function(){""!==n.trim()&&(i.sendMessage(new K(n)),r(""))},s=p(o),f=Object(u.a)(s,2),d=f[0],l=f[1];return c.a.createElement(z,null,c.a.createElement(H,{placeholder:"Enter your message",value:n,onChange:function(e){r(e.target.value)},onKeyPress:d,className:"MessageBoxInput_field",focused:l,autoFocus:!0}),c.a.createElement(m.a,{onClick:o,variant:"outlined",color:"primary",disabled:!n},"Send"))})),X=n(187),Y=n(179),Z=n(184),$=n(185);function ee(){var e=Object(o.a)(["\n  padding: 10px 20px;\n  margin-bottom: 20px;\n"]);return ee=function(){return e},e}var te=Object(v.a)(f.a)(ee()),ne=Object(a.memo)((function(){var e=Object(a.useState)([]),t=Object(u.a)(e,2),n=t[0],r=t[1],i=h();return Object(a.useEffect)((function(){i.users&&r(i.users)}),[i.users,n]),c.a.createElement(te,null,c.a.createElement(d.a,{variant:"subtitle1",color:"secondary",noWrap:!0},"Live users"),c.a.createElement(Y.a,null,n.map((function(e,t){return c.a.createElement(Z.a,{key:e.name},c.a.createElement($.a,{primary:"".concat(t+1,". ").concat(e.name)}))}))))})),ae=function e(t,n){Object(O.a)(this,e),this.iceCandidate=t,this.id=n},ce=n(19),re=n.n(ce),ie=n(31),oe=function e(t,n){Object(O.a)(this,e),this.answer=t,this.id=n},se={uri:"127.0.0.1:3001"},ue={config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]}},fe=function(){function e(){if(Object(O.a)(this,e),e.instance)return e.instance;this._init(),e.instance=this}return Object(b.a)(e,[{key:"_init",value:function(){this.rtc=new RTCPeerConnection(ue.config),this.remoteStream=new MediaStream,this.localStream=new MediaStream}},{key:"_getLocalStream",value:function(){var e=Object(ie.a)(re.a.mark((function e(){return re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"onAnswer",value:function(){var e=Object(ie.a)(re.a.mark((function e(t,n){return re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.rtc.setRemoteDescription(new RTCSessionDescription(t.answer));case 2:this._setIceListener(n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onOffer",value:function(){var e=Object(ie.a)(re.a.mark((function e(t,n,a){var c,r=this;return re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.rtc.addEventListener("track",function(){var e=Object(ie.a)(re.a.mark((function e(t){return re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.remoteStream.addTrack(t.track);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,this.rtc.setRemoteDescription(new RTCSessionDescription(t.offer));case 3:return e.next=5,this.rtc.createAnswer();case 5:return c=e.sent,e.next=8,this.rtc.setLocalDescription(c);case 8:a(new oe(c,t.id)),this._setIceListener(n);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"addIceCandidate",value:function(){var e=Object(ie.a)(re.a.mark((function e(t){return re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.rtc.addIceCandidate(t.iceCandidate);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log("Error adding received ice candidate");case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"sendOffer",value:function(){var e=Object(ie.a)(re.a.mark((function e(t){var n,a=this;return re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getLocalStream();case 2:return this.localStream=e.sent,this.localStream.getTracks().forEach(function(){var e=Object(ie.a)(re.a.mark((function e(t){return re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.rtc.addTrack(t,a.localStream);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=6,this.rtc.createOffer();case 6:return n=e.sent,e.next=9,this.rtc.setLocalDescription(n);case 9:t(n);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setIceListener",value:function(e){this.rtc.addEventListener("icecandidate",(function(t){t.candidate&&e(t.candidate)}))}}]),e}(),de=n(186);function le(){var e=Object(o.a)(["\n  display: inline-block;\n  max-width: 100%;\n  max-height: 100%;\n"]);return le=function(){return e},e}var me=v.a.video(le()),Oe=Object(a.memo)((function(){var e=Object(a.useRef)(null),t=h(),n=Object(a.useState)(null),r=Object(u.a)(n,2),i=r[0],o=r[1];Object(a.useEffect)((function(){var t=new fe;o(t),e.current.srcObject=t.remoteStream}),[]),Object(a.useEffect)((function(){t.answerContext&&i.onAnswer(t.answerContext,(function(e){return t.sendIceCandidateOffer(e)}))}),[t.answerContext]),Object(a.useEffect)((function(){t.offerContext&&i.onOffer(t.offerContext,(function(e){return t.sendIceCandidateAnswer(new ae(e,t.offerContext.id))}),(function(e){return t.sendAnswer(e)}))}),[t.offerContext]),Object(a.useEffect)((function(){t.iceCandidateAnswer&&i.addIceCandidate(t.iceCandidateAnswer)}),[t.iceCandidateAnswer]),Object(a.useEffect)((function(){t.iceCandidateOffer&&i.addIceCandidate(t.iceCandidateOffer)}),[t.iceCandidateOffer]);return c.a.createElement(N.a,null,c.a.createElement(de.a,null,c.a.createElement(m.a,{onClick:function(){2===t.users.length?i.sendOffer((function(e){return t.sendOffer(e)})):alert("Video translation available for 2 users in room only")}},"translate video")),c.a.createElement(R.a,null,c.a.createElement(me,{ref:e,title:"Local webcam video",autoPlay:!0,playsinlines:!0})))}));function be(){var e=Object(o.a)(["\n  min-height: 200px;\n  text-align: center;\n"]);return be=function(){return e},e}var Ee=Object(v.a)(X.a)(be()),je=Object(a.memo)((function(){return c.a.createElement(X.a,{container:!0,spacing:3},c.a.createElement(Ee,{item:!0,xs:12}),c.a.createElement(X.a,{item:!0,xs:3},c.a.createElement(Oe,null)),c.a.createElement(X.a,{item:!0,xs:6},c.a.createElement(B,null),c.a.createElement(Q,null)),c.a.createElement(X.a,{item:!0,xs:3},c.a.createElement(ne,null)))}));function he(){var e=Object(o.a)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]);return he=function(){return e},e}function Ce(){var e=Object(o.a)(["\n  min-height: 100vh;\n  padding-top: 10px;\n  padding-bottom: 10px;\n"]);return Ce=function(){return e},e}var we=Object(v.a)(s.a)(Ce()),pe=Object(v.a)(we)(he()),ve=function(){var e=Object(C.d)(),t=h();return Object(a.useEffect)((function(){!0===t.isChatEntered&&e.push("/".concat(t.room.name))}),[e,t.isChatEntered,t.room]),c.a.createElement(S.b,{injectFirst:!0},t.isChatEntered?c.a.createElement(we,null,c.a.createElement(je,null)):c.a.createElement(pe,null,c.a.createElement(_,null)))},ge=n(50),ye=n(90),xe=n.n(ye),ke={CONNECT:"connect",DISCONNECT:"disconnect",SUCCESS_ROOM_ENTER:"successEnter",ROOM_USERS:"liveRoomUsers",MESSAGE:"broadcastChatMessage"},_e={ENTER_ROOM:"enterRoom",SEND_MESSAGE:"sendChatMessage"},Se={ON:{ANSWER:"getAnswer",OFFER:"getOffer",ICE_CANDIDATE_OFFER:"getIceCandidateOffer",ICE_CANDIDATE_ANSWER:"getIceCandidateAnswer"},EMIT:{SEND_OFFER:"sendOffer",SEND_ANSWER:"sendAnswer",SEND_ICE_CANDIDATE_OFFER:"sendIceCandidateOffer",SEND_ICE_CANDIDATE_ANSWER:"sendIceCandidateAnswer"}},Ae=function e(t){Object(O.a)(this,e),this.name=t},Ie=function e(t){Object(O.a)(this,e),this.name=t},Re=function(){function e(t){Object(O.a)(this,e),this._socket=xe()(t)}return Object(b.a)(e,[{key:"onConnect",value:function(e){var t=this;this._socket.on(ke.CONNECT,(function(){console.log("Socket connected"),console.dir(t._socket),e()}))}},{key:"onDisconnect",value:function(e){this._socket.on(ke.DISCONNECT,(function(){console.log("Socket disconnected"),e()}))}},{key:"onChatEnter",value:function(e){this._socket.on(ke.SUCCESS_ROOM_ENTER,(function(t){console.log("Room entered"),console.dir(t),e(new Ae(t))}))}},{key:"onRoomUsers",value:function(e){this._socket.on(ke.ROOM_USERS,(function(t){console.log("List of room users changed"),console.dir(t);var n=t.map((function(e){return new Ie(e)}));e(n)}))}},{key:"onMessage",value:function(e){this._socket.on(ke.MESSAGE,(function(t){console.log("New message arrived"),console.dir(t),e(t)}))}},{key:"enterRoom",value:function(e){console.log("Connecting to room"),console.dir(e),this._socket.emit(_e.ENTER_ROOM,{name:e.username,room:e.room})}},{key:"sendMessage",value:function(e){console.log("Sending message"),console.dir(e),this._socket.emit(_e.SEND_MESSAGE,e)}},{key:"onOffer",value:function(e){this._socket.on(Se.ON.OFFER,(function(t){console.log("Got WebRtc offer"),console.dir(t),e(t)}))}},{key:"onAnswer",value:function(e){this._socket.on(Se.ON.ANSWER,(function(t){console.log("Got WebRtc answer"),console.dir(t),e(t)}))}},{key:"onIceCandidateOffer",value:function(e){this._socket.on(Se.ON.ICE_CANDIDATE_OFFER,(function(t){console.log("Got WebRtc iceCandidate from offer"),console.dir(t),e(t)}))}},{key:"onIceCandidateAnswer",value:function(e){this._socket.on(Se.ON.ICE_CANDIDATE_ANSWER,(function(t){console.log("Got WebRtc iceCandidate from answer"),console.dir(t),e(t)}))}},{key:"sendOffer",value:function(e){console.log("Sending WebRtc offer"),console.dir(e),this._socket.emit(Se.EMIT.SEND_OFFER,e)}},{key:"sendAnswer",value:function(e){console.log("Sending WebRtc answer"),console.dir(e),this._socket.emit(Se.EMIT.SEND_ANSWER,e)}},{key:"sendIceCandidateOffer",value:function(e){console.log("Sending WebRtc ICE candidate from offer"),console.dir(e),this._socket.emit(Se.EMIT.SEND_ICE_CANDIDATE_OFFER,e)}},{key:"sendIceCandidateAnswer",value:function(e){console.log("Sending WebRtc ICE candidate from answer"),console.dir(e),this._socket.emit(Se.EMIT.SEND_ICE_CANDIDATE_ANSWER,e)}},{key:"id",get:function(){return this._socket.id}}]),e}(),Ne=n(4),De={id:null,isChatEntered:!1,isConnected:!1,message:null,room:null,users:null,emits:{enterRoom:null,sendMessage:null},webrtc:{offerContext:null,answerContext:null,iceCandidateOffer:null,iceCandidateAnswer:null,emits:{sendOffer:null,sendAnswer:null,sendIceCandidateOffer:null,sendIceCandidateAnswer:null}}},Me=0,Te=1,Fe=2,We=3,Le=4,Ge=5,Ue=6,Pe=7,Je=8,Be=9,Ke=10,Ve=11,qe=12,ze=13,He=14,Qe=15,Xe=16;function Ye(e,t){switch(t.type){case Me:return Object(Ne.a)(Object(Ne.a)({},e),{},{id:t.id});case Te:return Object(Ne.a)(Object(Ne.a)({},e),{},{isConnected:!0});case Fe:return Object(Ne.a)(Object(Ne.a)({},e),{},{isChatEntered:!1,isConnected:!1});case We:return Object(Ne.a)(Object(Ne.a)({},e),{},{isChatEntered:!1});case Le:return Object(Ne.a)(Object(Ne.a)({},e),{},{message:t.message});case Ge:return Object(Ne.a)(Object(Ne.a)({},e),{},{room:t.room,isChatEntered:!0});case Ue:return Object(Ne.a)(Object(Ne.a)({},e),{},{users:t.users});case Pe:return Object(Ne.a)(Object(Ne.a)({},e),{},{emits:Object(Ne.a)(Object(Ne.a)({},e.emits),{},{enterRoom:t.enterRoom})});case Je:return Object(Ne.a)(Object(Ne.a)({},e),{},{emits:Object(Ne.a)(Object(Ne.a)({},e.emits),{},{sendMessage:t.sendMessage})});case Be:return Object(Ne.a)(Object(Ne.a)({},e),{},{webrtc:Object(Ne.a)(Object(Ne.a)({},e.webrtc),{},{offerContext:t.offerContext})});case Ke:return Object(Ne.a)(Object(Ne.a)({},e),{},{webrtc:Object(Ne.a)(Object(Ne.a)({},e.webrtc),{},{answerContext:t.answerContext})});case Ve:return Object(Ne.a)(Object(Ne.a)({},e),{},{webrtc:Object(Ne.a)(Object(Ne.a)({},e.webrtc),{},{iceCandidateOffer:t.iceCandidateOffer})});case qe:return Object(Ne.a)(Object(Ne.a)({},e),{},{webrtc:Object(Ne.a)(Object(Ne.a)({},e.webrtc),{},{iceCandidateAnswer:t.iceCandidateAnswer})});case ze:return Object(Ne.a)(Object(Ne.a)({},e),{},{webrtc:Object(Ne.a)(Object(Ne.a)({},e.webrtc),{},{emits:Object(Ne.a)(Object(Ne.a)({},e.webrtc.emits),{},{sendOffer:t.sendOffer})})});case He:return Object(Ne.a)(Object(Ne.a)({},e),{},{webrtc:Object(Ne.a)(Object(Ne.a)({},e.webrtc),{},{emits:Object(Ne.a)(Object(Ne.a)({},e.webrtc.emits),{},{sendAnswer:t.sendAnswer})})});case Qe:return Object(Ne.a)(Object(Ne.a)({},e),{},{webrtc:Object(Ne.a)(Object(Ne.a)({},e.webrtc),{},{emits:Object(Ne.a)(Object(Ne.a)({},e.webrtc.emits),{},{sendIceCandidateOffer:t.sendIceCandidateOffer})})});case Xe:return Object(Ne.a)(Object(Ne.a)({},e),{},{webrtc:Object(Ne.a)(Object(Ne.a)({},e.webrtc),{},{emits:Object(Ne.a)(Object(Ne.a)({},e.webrtc.emits),{},{sendIceCandidateAnswer:t.sendIceCandidateAnswer})})});default:return e}}var Ze=function(e){var t=Object(a.useReducer)(Ye,De),n=Object(u.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){var e=new Re(se.uri);e.onConnect((function(){i({type:Me,id:e.id}),i({type:Te})})),e.onDisconnect((function(){i({type:Fe})})),e.onChatEnter((function(e){i({type:Ge,room:e})})),e.onRoomUsers((function(e){i({type:Ue,users:e})})),e.onMessage((function(e){i({type:Le,message:e})})),e.onOffer((function(e){i({type:Be,offerContext:e})})),e.onAnswer((function(e){i({type:Ke,answerContext:e})})),e.onIceCandidateOffer((function(e){i({type:Ve,iceCandidateOffer:e})})),e.onIceCandidateAnswer((function(e){i({type:qe,iceCandidateAnswer:e})})),i({type:Pe,enterRoom:function(t){return e.enterRoom(t)}}),i({type:Je,sendMessage:function(t){return e.sendMessage(t)}}),i({type:ze,sendOffer:function(t){return e.sendOffer(t)}}),i({type:He,sendAnswer:function(t){return e.sendAnswer(t)}}),i({type:Qe,sendIceCandidateOffer:function(t){return e.sendIceCandidateOffer(t)}}),i({type:Xe,sendIceCandidateAnswer:function(t){return e.sendIceCandidateAnswer(t)}})}),[]),c.a.createElement(j.Provider,{value:r},e.children)};i.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(ge.a,null,c.a.createElement(Ze,null,c.a.createElement(ve,null)))),document.getElementById("root"))}},[[104,1,2]]]);
//# sourceMappingURL=main.483fc20d.chunk.js.map